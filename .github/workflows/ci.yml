name: CI - Build and Test

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-and-test:
    name: Build and Test
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Type check
      run: npm run type-check
      
    - name: Lint code
      run: npm run lint
      
    - name: Format check
      run: npm run format:check
      
    - name: Build application
      run: npm run build
      
    - name: Test build output
      run: |
        ls -la dist/
        echo "‚úÖ Build completed successfully!"
        
  # –≠—Ç–æ—Ç job –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
  deploy-info:
    name: Deployment Info
    runs-on: ubuntu-latest
    needs: build-and-test
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
    - name: Deployment Instructions
      run: |
        echo "üöÄ Build completed successfully!"
        echo ""
        echo "üìã To enable automatic deployment to Vercel:"
        echo "1. Go to GitHub Repository Settings ‚Üí Secrets and variables ‚Üí Actions"
        echo "2. Add the following secrets:"
        echo "   - VERCEL_TOKEN (from Vercel Dashboard ‚Üí Settings ‚Üí Tokens)"
        echo "   - VERCEL_ORG_ID (run 'vercel env ls' in project folder)"
        echo "   - VERCEL_PROJECT_ID (run 'vercel env ls' in project folder)"
        echo ""
        echo "üìñ Or deploy manually:"
        echo "   - Visit: https://vercel.com/new/clone?repository-url=https://github.com/Richbanker/Finance-Mini-App"
        echo "   - Click 'Deploy' button"
        echo ""
        echo "‚ú® Your app is ready for production!"
