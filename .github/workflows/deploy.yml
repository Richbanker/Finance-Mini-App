name: Deploy to Vercel

# –≠—Ç–æ—Ç workflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
on:
  push:
    branches: [ main, master ]

jobs:
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
  check-secrets:
    name: Check Deployment Secrets
    runs-on: ubuntu-latest
    outputs:
      has-secrets: ${{ steps.check.outputs.has-secrets }}
    steps:
    - name: Check for Vercel secrets
      id: check
      run: |
        if [[ -n "${{ secrets.VERCEL_TOKEN }}" && -n "${{ secrets.VERCEL_ORG_ID }}" && -n "${{ secrets.VERCEL_PROJECT_ID }}" ]]; then
          echo "has-secrets=true" >> $GITHUB_OUTPUT
        else
          echo "has-secrets=false" >> $GITHUB_OUTPUT
        fi

  # –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
  deploy:
    name: Deploy to Vercel
    runs-on: ubuntu-latest
    needs: check-secrets
    if: needs.check-secrets.outputs.has-secrets == 'true'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Deploy to Vercel
      uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        vercel-args: '--prod'
        working-directory: './'
        github-comment: false
        github-deployment: false

  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
  deploy-instructions:
    name: Deployment Instructions
    runs-on: ubuntu-latest
    needs: check-secrets
    if: needs.check-secrets.outputs.has-secrets == 'false'
    
    steps:
    - name: Show deployment instructions
      run: |
        echo "üîê Vercel deployment secrets not configured"
        echo ""
        echo "üìã To enable automatic deployment:"
        echo "1. Go to GitHub Repository Settings ‚Üí Secrets and variables ‚Üí Actions"
        echo "2. Add these secrets:"
        echo "   ‚Ä¢ VERCEL_TOKEN - from Vercel Dashboard ‚Üí Settings ‚Üí Tokens"
        echo "   ‚Ä¢ VERCEL_ORG_ID - run 'vercel env ls' in project"
        echo "   ‚Ä¢ VERCEL_PROJECT_ID - run 'vercel env ls' in project"
        echo ""
        echo "üöÄ Manual deployment:"
        echo "   Visit: https://vercel.com/new/clone?repository-url=https://github.com/Richbanker/Finance-Mini-App"
        echo ""
        echo "‚úÖ Your code is ready for deployment!"